隧道是一种封装技术，它利用一种网络协议来传输另一种网络协议，即利用一种网络传输协议，将其他协议产生的数据报文封装在它自己的报文中，然后在网络中传输。

实际上隧道可以看作一个虚拟的点到点连接。例如，GRE隧道仅支持点到点的业务接入。

隧道技术简单地说就是：原始报文在A地进行封装，到达B地后把封装去掉，还原成原始报文，这样就形成了一条由A到B的通信隧道。

隧道技术就是指包括数据封装、传输和解封装在内的全过程。隧道是通过隧道协议实现的，隧道协议规定了隧道的建立，维护和删除规则，
以及怎样将原始数据封装在隧道中进行传输。

 隧道协议分类
 （1）第二层隧道协议，如PPTP，L2TP
 （2）第三层隧道协议，如GRE，IPsec
 
 
 GRE（通用路由封装协议），GRE是对某些网络层协议（如IP，IPX，AppleTalk等）的数据报文进行封装，使这些被封装的数据报文能在另一个网络层（IP）中传输。
 但是最新版本的GRE已经可以封装二层数据帧了，如PPP帧，MPLS等。在RFC2784中，GRE的定义是“X over Y”，X和Y可以是任意的协议。GRE就真的成立通用路由封装了。
   
 GRE协议实际上是一种封装协议，它提供了将一种协议的报文封装在另一种协议报文中的机制，使报文能够在异种网络中传输。异种报文传输的通道称为tunnel（隧道）
 GRE隧道不能配置二层信息，但是可以配置IP地址。GRE利用为隧道指定的实际物理接口完成转发，转发过程如下：
 （1）所有发往远端VPN的原始报文，首先被发送到隧道源端
 （2）原始报文在隧道源端 进行GRE封装，填写隧道建立时确定的隧道源地址和目的地址，然后再通过公共IP网络转发到远端VPN网络。


乘客协议：指用户要传输的数据，也就是被封装的数据。这是用户真正要传输的数据。
封装协议用于建立、保持和拆卸隧道。GRE属于封装协议。
运输协议：乘客协议被封装后应用的运输协议。IP协议就是常见的运输协议，一般使用IP协议对GRE协议报文进行运输。
 
 
 GRE隧道配置
 1.创建Tunnel接口                
 sy                        进入系统视图
 interface Tunnel 1/0/1    创建Tunnel接口

 2.激活Tunnel接口
 激活  Tunnel接口 
 undo shutdown
 
3.配置Tunnel接口的网络地址
 默认情况下 ，路由器未设置Tunnel接口的网络地址。为使隧道支持动态路由协议，我们还要配置Tunnel接口的网络地址。
 ip address 192.168.0.2 255.255.255.0
 
 4.配置Tunnel接口的源端地址和目的端地址
 配置Tunnel接口的源端地址和目的端地址
 source       IP
 destination  IP
 
 
 5.配置GRE的安全选项
 缺省情况下，隧道两端不进行端到端校验，不使用识别关键字。
 为了提高GRE隧道的安全性，我们要设置隧道进行端到端校验，并且设置隧道接口的识别关键字。
 
 gre checksum       设置Tunnel进行端到端校验
 gre key key-number 设置Tunnel接口的识别关键字
 
 
 6.配置Tunnel的路由
 在源端路由器和目的端路由器上，都必须存在经过Tunnel转发的路由。隧道路由可以配置静态路由或配置动态路由，这样，需要进行GRE封装的报文才能正确转发。
 配置静态路由时，需要注意：目的地址不是Tunnel的目的端地址，而是未进行GRE封装的报文的目的地址，下一跳是对端Tunnel接口。
 ip route-static dest-ip-address{mask|mask-length} tunnel tunnel-number 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
